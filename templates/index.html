<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰“å¡ç´€éŒ„ç®¡ç†ç³»çµ±</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="header">
        <h1>æ‰“å¡ç´€éŒ„ç®¡ç†ç³»çµ±</h1>
        <div class="user-info">
            ä½¿ç”¨è€…ï¼š{{ user }}
            <a href="{{ url_for('logout') }}" class="logout-btn">ç™»å‡º</a>
        </div>
        <div style="display: flex; gap: 10px;">
            <a href="{{ url_for('qrcode_page') }}">
                <button>ğŸ“± QR Code æ‰“å¡</button>
            </a>
            <a href="{{ url_for('search_page') }}">
                <button style="background-color: #2196F3;">ğŸ” æœå°‹å’ŒåŒ¯å‡º</button>
            </a>
        </div>
    </div>

    <!-- æ‰€æœ‰è¨˜éŒ„ç®¡ç†å€ -->
    <div class="section-title">
        <h2>ğŸ“‹ æ‰€æœ‰æ‰“å¡è¨˜éŒ„</h2>
    </div>

    <table>
        <tr>
            <th>åºè™Ÿ</th><th>å§“å</th><th>èº«åˆ†è­‰</th>
            <th>ä¸Šç­</th><th>ä¸‹ç­</th><th>æœå‹™é …ç›®</th><th>æœå‹™å…§å®¹</th>
            <th>å·¥æ™‚</th><th>åˆ†é˜</th><th>æœå‹™äººæ•¸</th>
            <th>äº¤é€šè²»</th><th>é¤è²»</th><th>æœå‹™åœ°å€</th><th>å‚™è¨»</th>
            <th>åŒ¯å…¥å‹•ä½œ</th><th>æµ·å¤–æœå‹™</th><th>åœ‹å…§æœå‹™</th><th>æ“ä½œ</th>
        </tr>
        {% for r in records %}
        <tr>
            <td>{{ r.serial_no }}</td>
            <td>{{ r.name }}</td>
            <td>{{ r.id_number }}</td>
            <td>{{ r.service_start }}</td>
            <td>{{ r.service_end }}</td>
            <td>{{ r.service_item }}</td>
            <td>{{ r.service_content }}</td>
            <td>{{ r.service_hours }}</td>
            <td>{{ r.service_minutes }}</td>
            <td>{{ r.served_people_count }}</td>
            <td>{{ r.transport_fee }}</td>
            <td>{{ r.meal_fee }}</td>
            <td>{{ r.service_area or '' }}</td>
            <td>{{ r.remarks or '' }}</td>
            <td>{{ r.import_action or '' }}</td>
            <td>{{ r.foreign_service_count }}</td>
            <td>{{ r.domestic_service_count }}</td>
            <td>
                <a href="{{ url_for('edit', serial_no=r.serial_no) }}">âœï¸</a> |
                <a href="{{ url_for('delete', serial_no=r.serial_no) }}" onclick="return confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')">ğŸ—‘ï¸</a>
            </td>
        </tr>
        {% endfor %}
    </table>

    <!-- åˆ†é æ§åˆ¶ -->
    <div class="pagination">
        <div class="page-info">
            ç¬¬ {{ all_records_page }} é ï¼Œå…± {{ total_all_pages }} é  (ç¸½å…± {{ total_all_records }} ç­†è¨˜éŒ„)
        </div>
        
        <div class="page-buttons">
            {% if all_records_page > 1 %}
            <a href="{{ url_for('admin_panel', all_records_page=1) }}" class="page-btn">âŸª</a>
            <a href="{{ url_for('admin_panel', all_records_page=all_records_page-1) }}" class="page-btn">âŸ¨</a>
            {% endif %}

            {% set window_size = 2 %}
            {% set start_page = all_records_page - window_size %}
            {% set end_page = all_records_page + window_size %}
            
            {% if start_page < 1 %}
                {% set end_page = end_page - start_page + 1 %}
                {% set start_page = 1 %}
            {% endif %}
            {% if end_page > total_all_pages %}
                {% set start_page = start_page - (end_page - total_all_pages) %}
                {% set end_page = total_all_pages %}
            {% endif %}
            {% if start_page < 1 %}
                {% set start_page = 1 %}
            {% endif %}

            {% if start_page > 1 %}
                {% if start_page > 2 %}
                    <span class="dots">...</span>
                {% endif %}
            {% endif %}

            {% for p in range(start_page, end_page + 1) %}
                {% if p == all_records_page %}
                    <span class="current-page">{{ p }}</span>
                {% else %}
                    <a href="{{ url_for('admin_panel', all_records_page=p) }}" class="page-btn">{{ p }}</a>
                {% endif %}
            {% endfor %}

            {% if end_page < total_all_pages - 1 %}
                <span class="dots">...</span>
            {% endif %}

            {% if all_records_page < total_all_pages %}
            <a href="{{ url_for('admin_panel', all_records_page=all_records_page+1) }}" class="page-btn">âŸ©</a>
            {% endif %}
        </div>
    </div>

    <script src="{{ url_for('static', filename='scroll-fix.js') }}"></script>
</body>
</html>